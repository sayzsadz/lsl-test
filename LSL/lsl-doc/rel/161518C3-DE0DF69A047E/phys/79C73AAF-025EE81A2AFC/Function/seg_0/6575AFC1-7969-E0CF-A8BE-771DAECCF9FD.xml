<?xml version = '1.0' encoding = 'UTF-8'?>
<FunctionOracle class="oracle.dbtools.crest.model.design.storage.oracle.FunctionOracle" name="XXPBSA_CRUD_EBS_SUPPLIERS" directorySegmentName="seg_0" id="6575AFC1-7969-E0CF-A8BE-771DAECCF9FD">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>XXPBSA_CRUD_EBS_SUPPLIERS</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:32 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE function APEX.XXPBSA_CRUD_EBS_SUPPLIERS&lt;br/&gt;return varchar2&lt;br/&gt;as&lt;br/&gt;  l_cursor SYS_REFCURSOR;&lt;br/&gt;  l_msg    varchar2(20000);&lt;br/&gt;&lt;br/&gt;  cursor cur &lt;br/&gt;    is&lt;br/&gt;    select *&lt;br/&gt;    from (&lt;br/&gt;    select aps.vendor_id, apsa.vendor_site_id, aps.attribute11, aps.attribute10, vendor_name&lt;br/&gt;    from ap_suppliers@DBLINK2 aps&lt;br/&gt;        ,ap_supplier_sites_all@DBLINK2 apsa&lt;br/&gt;    where 1 = 1&lt;br/&gt;          AND aps.vendor_id = apsa.vendor_id&lt;br/&gt;          and aps.attribute11 is null&lt;br/&gt;    order by aps.last_update_date desc, apsa.last_update_date desc&lt;br/&gt;    )&lt;br/&gt;    where rownum = 1;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;  for cur_rec in cur&lt;br/&gt;  loop&lt;br/&gt;&lt;br/&gt;    SELECT replace(json_object(&lt;br/&gt;                                   &apos;SupplierId&apos;     VALUE NVL(apsl.attribute10,&apos;null&apos;),&lt;br/&gt;                                   &apos;Name&apos;           VALUE apsl.vendor_name,&lt;br/&gt;                                   &apos;BillToAddress&apos;  VALUE (&lt;br/&gt;                                                             json_object(&apos;Street&apos;    VALUE BillToAddress.Street,&lt;br/&gt;                                                                         &apos;City&apos;             VALUE BillToAddress.City,&lt;br/&gt;                                                                         &apos;State&apos;                VALUE BillToAddress.State,&lt;br/&gt;                                                                         &apos;PostCode&apos;                 VALUE BillToAddress.PostCode,&lt;br/&gt;                                                                         &apos;Country&apos;                     VALUE BillToAddress.Country,&lt;br/&gt;                                                                         &apos;ContactName&apos;              VALUE BillToAddress.ContactName,&lt;br/&gt;                                                                         &apos;Phone&apos;           VALUE BillToAddress.phone,&lt;br/&gt;                                                                         &apos;Email&apos;            VALUE BillToAddress.email&lt;br/&gt;                                                                         )&lt;br/&gt;                                                                         ),&lt;br/&gt;                                  &apos;ShipToAddress&apos;  VALUE (&lt;br/&gt;                                                             json_object(&apos;Street&apos;    VALUE ShipToAddress.Street,&lt;br/&gt;                                                                         &apos;City&apos;             VALUE ShipToAddress.City,&lt;br/&gt;                                                                         &apos;State&apos;                VALUE ShipToAddress.State,&lt;br/&gt;                                                                         &apos;PostCode&apos;                 VALUE ShipToAddress.PostCode,&lt;br/&gt;                                                                         &apos;Country&apos;                     VALUE ShipToAddress.Country,&lt;br/&gt;                                                                         &apos;ContactName&apos;              VALUE ShipToAddress.ContactName,&lt;br/&gt;                                                                         &apos;Phone&apos;           VALUE ShipToAddress.Phone,&lt;br/&gt;                                                                         &apos;Email&apos;            VALUE ShipToAddress.Email&lt;br/&gt;                                                                         )&lt;br/&gt;                                                                         ),&lt;br/&gt;                                  &apos;Active&apos;         VALUE dummy.Active&lt;br/&gt;                                  FORMAT JSON),&apos;null&apos;)&lt;br/&gt;    into l_msg&lt;br/&gt;    from (select &apos;true&apos; as Active from dual) dummy,&lt;br/&gt;         ap_suppliers@DBLINK2 apsl,&lt;br/&gt;         ap_supplier_sites_all@DBLINK2 apssl,&lt;br/&gt;         (&lt;br/&gt;          select apss.ADDRESS_LINE1 as Street&lt;br/&gt;          ,apss.ADDRESS_LINE2 as  City&lt;br/&gt;          ,nvl(apss.STATE,&apos;N/A&apos;) as State&lt;br/&gt;          ,nvl(apss.zip,&apos;N/A&apos;) PostCode&lt;br/&gt;          ,ftl.NLS_TERRITORY AS Country&lt;br/&gt;          ,NVL(apsc.first_name || apsc.last_name, aps.vendor_name) as ContactName&lt;br/&gt;          ,nvl(apsc.phone,&apos;00000000000&apos;) as Phone&lt;br/&gt;          ,nvl(apsc.email_address,&apos;test@example.com&apos;) as Email&lt;br/&gt;          ,apss.vendor_site_id&lt;br/&gt;          ,aps.vendor_id&lt;br/&gt;    from ap_suppliers@DBLINK2 aps&lt;br/&gt;        ,ap_supplier_sites_all@DBLINK2 apss&lt;br/&gt;        ,ap_supplier_contacts@DBLINK2 apsc        &lt;br/&gt;        ,hr_locations_all@DBLINK2 hla&lt;br/&gt;        ,apps.fnd_territories@DBLINK2 ftl&lt;br/&gt;    where 1 = 1 &lt;br/&gt;          AND aps.vendor_id = apss.vendor_id&lt;br/&gt;          AND apss.bill_to_location_id = hla.location_id&lt;br/&gt;          AND apss.vendor_site_id = apsc.vendor_site_id(+)&lt;br/&gt;          AND hla.COUNTRY = ftl.TERRITORY_CODE&lt;br/&gt;&lt;br/&gt;         ) BillToAddress,&lt;br/&gt;         (&lt;br/&gt;         select apss.ADDRESS_LINE1 as Street&lt;br/&gt;          ,apss.ADDRESS_LINE2 as  City&lt;br/&gt;          ,nvl(apss.STATE,&apos;N/A&apos;) as State&lt;br/&gt;          ,nvl(apss.zip,&apos;N/A&apos;) PostCode&lt;br/&gt;          ,ftl.NLS_TERRITORY AS Country&lt;br/&gt;          ,NVL(apsc.first_name || apsc.last_name, aps.vendor_name) as ContactName&lt;br/&gt;          ,nvl(apsc.phone,&apos;00000000000&apos;) as Phone&lt;br/&gt;          ,nvl(apsc.email_address,&apos;test@example.com&apos;) as Email&lt;br/&gt;          ,apss.vendor_site_id&lt;br/&gt;          ,aps.vendor_id&lt;br/&gt;    from ap_suppliers@DBLINK2 aps&lt;br/&gt;        ,ap_supplier_sites_all@DBLINK2 apss&lt;br/&gt;        ,ap_supplier_contacts@DBLINK2 apsc        &lt;br/&gt;        ,hr_locations_all@DBLINK2 hla&lt;br/&gt;        ,fnd_territories@DBLINK2 ftl&lt;br/&gt;    where 1 = 1 &lt;br/&gt;          AND aps.vendor_id = apss.vendor_id&lt;br/&gt;          AND apss.ship_to_location_id = hla.location_id&lt;br/&gt;          AND apss.vendor_site_id = apsc.vendor_site_id(+)&lt;br/&gt;          AND hla.COUNTRY = ftl.TERRITORY_CODE&lt;br/&gt;&lt;br/&gt;         ) ShipToAddress&lt;br/&gt;    where 1 = 1 &lt;br/&gt;          AND BillToAddress.vendor_id = apsl.vendor_id&lt;br/&gt;          AND ShipToAddress.vendor_id = apsl.vendor_id&lt;br/&gt;          AND BillToAddress.vendor_site_id = apssl.vendor_site_id&lt;br/&gt;          AND ShipToAddress.vendor_site_id = apssl.vendor_site_id&lt;br/&gt;          AND apsl.vendor_id = apssl.vendor_id&lt;br/&gt;          AND apsl.vendor_id = cur_rec.vendor_id&lt;br/&gt;          AND apssl.vendor_site_id = cur_rec.vendor_site_id;&lt;br/&gt;&lt;br/&gt;  end loop;&lt;br/&gt;&lt;br/&gt;  return l_msg;&lt;br/&gt;&lt;br/&gt;END;</source>
</FunctionOracle>