<?xml version = '1.0' encoding = 'UTF-8'?>
<FunctionOracle class="oracle.dbtools.crest.model.design.storage.oracle.FunctionOracle" name="XXPBSA_HO_REQUEST_PBSAPOS_DATA" directorySegmentName="seg_0" id="3A574FED-79C8-2FE8-047B-80E34B160ADB">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>XXPBSA_HO_REQUEST_PBSAPOS_DATA</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:32 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE function APEX.XXPBSA_HO_REQUEST_PBSAPOS_DATA (&lt;br/&gt;                                                              p_url           in varchar2&lt;br/&gt;                                                            , p_proc_name     in varchar2&lt;br/&gt;                                                            , p_param1        in varchar2&lt;br/&gt;                                                            , p_param2        in varchar2&lt;br/&gt;                                                           )&lt;br/&gt;return clob&lt;br/&gt;is                                                      &lt;br/&gt;  l_clob         clob;&lt;br/&gt;  l_buffer       varchar2(32767);&lt;br/&gt;  l_amount       number;&lt;br/&gt;  l_offset       number;&lt;br/&gt;  l_body         varchar2(2000);&lt;br/&gt;  l_param        varchar2(2000);&lt;br/&gt;  l_token_type   varchar2(30);&lt;br/&gt;  l_access_token varchar2(2000);&lt;br/&gt;  l_url          varchar2(1000);&lt;br/&gt;  l_https_host   varchar2(50);&lt;br/&gt;  l_wallet_path  varchar2(50);&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;&lt;br/&gt;  select TOKEN_TYPE,&lt;br/&gt;         ACCESS_TOKEN,&lt;br/&gt;         HTTPS_HOST,&lt;br/&gt;         WALLET_PATH&lt;br/&gt;  into l_token_type,&lt;br/&gt;       l_access_token,&lt;br/&gt;       l_https_host,&lt;br/&gt;       l_wallet_path&lt;br/&gt;  from XXPBSA_HO_OAUTH&lt;br/&gt;  where 1 = 1&lt;br/&gt;        AND SYSDATE between START_DATE and END_DATE;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;      apex_web_service.g_request_headers(1).name    := &apos;Authorization&apos;;&lt;br/&gt;      apex_web_service.g_request_headers(1).value   := l_token_type||&apos; &apos;||l_access_token;&lt;br/&gt;      apex_web_service.g_request_headers(2).name    := &apos;Content-Type&apos;;&lt;br/&gt;      apex_web_service.g_request_headers(2).value   := &apos;application/json&apos;;&lt;br/&gt;&lt;br/&gt;       l_param := p_proc_name;&lt;br/&gt;&lt;br/&gt;    begin&lt;br/&gt;    IF l_param = &apos;purchase-orders&apos;&lt;br/&gt;        THEN&lt;br/&gt;            &lt;br/&gt;            l_body := XXPBSA_PO_PAYLOAD(p_po_num =&gt; p_param1);&lt;br/&gt;           &lt;br/&gt;    ELSIF l_param = &apos;suppliers&apos;&lt;br/&gt;        THEN&lt;br/&gt;            BEGIN&lt;br/&gt;              l_body := XXPBSA_CRUD_EBS_SUPPLIERS;&lt;br/&gt;            END;&lt;br/&gt;    ELSIF l_param = &apos;supplier-returns&apos;&lt;br/&gt;        THEN&lt;br/&gt;            BEGIN&lt;br/&gt;              l_body := XXPBSA_SUP_RET_PAYLOAD;&lt;br/&gt;              &lt;br/&gt;            END;&lt;br/&gt;    ELSIF l_param = &apos;rejected-lines&apos;&lt;br/&gt;        THEN&lt;br/&gt;            BEGIN&lt;br/&gt;              l_body := XXPBSA_RET_LINES_PAYLOAD;&lt;br/&gt;            END;            &lt;br/&gt;    ELSE&lt;br/&gt;            l_body := &apos;{}&apos;;&lt;br/&gt;    END IF;&lt;br/&gt;    end;&lt;br/&gt;&lt;br/&gt;  l_url := p_url;&lt;br/&gt;&lt;br/&gt;  -- Invoke the PBSA web service to retrieve data&lt;br/&gt;&lt;br/&gt;        select APEX_WEB_SERVICE.make_rest_request (    p_url         =&gt; l_url,&lt;br/&gt;                                                       p_http_method =&gt; &apos;POST&apos;,&lt;br/&gt;                                                       p_body        =&gt; l_body,&lt;br/&gt;                                                       -- p_parm_name   =&gt; apex_util.string_to_table(&apos;appid:format&apos;),&lt;br/&gt;                                                       -- p_parm_value  =&gt; apex_util.string_to_table(apex_application.g_x01||&apos;:&apos;||apex_application.g_x02)&lt;br/&gt;                                                       p_wallet_path =&gt; l_wallet_path,&lt;br/&gt;                                                       p_wallet_pwd  =&gt; null,&lt;br/&gt;                                                       p_https_host  =&gt; l_https_host&lt;br/&gt;                                                     )&lt;br/&gt;        into l_clob&lt;br/&gt;        from dual;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;      return l_clob;&lt;br/&gt;&lt;br/&gt;end;</source>
</FunctionOracle>