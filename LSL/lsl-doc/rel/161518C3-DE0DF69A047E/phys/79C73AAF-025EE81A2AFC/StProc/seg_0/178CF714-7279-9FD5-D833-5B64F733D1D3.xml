<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="CREATE_SUPPLIER_RETURN" directorySegmentName="seg_0" id="178CF714-7279-9FD5-D833-5B64F733D1D3">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>CREATE_SUPPLIER_RETURN</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:27 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE PROCEDURE  APEX.CREATE_SUPPLIER_RETURN (p_data IN varchar2, p_msg OUT varchar2) &lt;br/&gt;AS&lt;br/&gt;l_msg         varchar2(1000);&lt;br/&gt;--l_code        l_msg.v_code%type;         &lt;br/&gt;--l_desc        l_msg.v_desc%type;&lt;br/&gt;--var_code l_code;&lt;br/&gt;--var_desc l_desc;&lt;br/&gt;&lt;br/&gt;ex_custom       EXCEPTION;&lt;br/&gt;BEGIN&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;INSERT INTO SUPPLIER_RET_REQUESTS_HEADER(SupplierReturnRequestId, StoreId, Street, City, State, PostCode, Country, ContactName, Phone, Email)&lt;br/&gt;   SELECT SupplierReturnRequestId, StoreId, Street, City, State, PostCode, Country, ContactName, Phone, Email        &lt;br/&gt;   FROM json_table(p_data format JSON , &apos;$&apos; COLUMNS &lt;br/&gt;   ( SupplierReturnRequestId VARCHAR2 PATH &apos;$.SupplierReturnRequestId&apos;,&lt;br/&gt;     StoreId VARCHAR2 PATH &apos;$.StoreId&apos;, &lt;br/&gt;     &lt;br/&gt;     NESTED PATH &apos;$.Address[*]&apos; &lt;br/&gt;   COLUMNS (      &lt;br/&gt;                Street VARCHAR2 PATH &apos;$.Street&apos;, &lt;br/&gt;                City VARCHAR2 PATH &apos;$.City&apos;, &lt;br/&gt;                State VARCHAR2 PATH &apos;$.State&apos;, &lt;br/&gt;                PostCode VARCHAR2 PATH &apos;$.PostCode&apos;, &lt;br/&gt;                Country VARCHAR2 PATH &apos;$.Country&apos;, &lt;br/&gt;                ContactName VARCHAR2 PATH &apos;$.ContactName&apos;, &lt;br/&gt;                Phone VARCHAR2 PATH &apos;$.Phone&apos;, &lt;br/&gt;                Email VARCHAR2 PATH &apos;$.Email&apos;&lt;br/&gt;             )&lt;br/&gt;     &lt;br/&gt;     ));&lt;br/&gt;&lt;br/&gt;             --RAISE ex_custom;&lt;br/&gt;&lt;br/&gt;   INSERT INTO SUPPLIER_RET_REQUESTS_LINES (SupplierReturnRequestId, ProductId, Quantity, Unit, SupplierId, PurchaseOrderId  )&lt;br/&gt;   SELECT SupplierReturnRequestId, ProductId, Quantity, Unit, SupplierId, PurchaseOrderId          &lt;br/&gt;   FROM json_table(p_data format JSON , &apos;$&apos; COLUMNS &lt;br/&gt;   (&lt;br/&gt;     SupplierReturnRequestId VARCHAR2 PATH &apos;$.SupplierReturnRequestId&apos;,&lt;br/&gt;     --StoreId VARCHAR2 PATH &apos;$.StoreId&apos;, &lt;br/&gt;     &lt;br/&gt;&lt;br/&gt;      &lt;br/&gt;   NESTED PATH &apos;$.Lines[*]&apos; &lt;br/&gt;   COLUMNS ( --SupplierReturnRequestId VARCHAR2 PATH &apos;$.SupplierReturnRequestId&apos;, &lt;br/&gt;             ProductId VARCHAR2 PATH &apos;$.ProductId&apos;,&lt;br/&gt;             Quantity VARCHAR2 PATH &apos;$.Quantity&apos;,&lt;br/&gt;             Unit VARCHAR2 PATH &apos;$.Unit&apos;,&lt;br/&gt;             SupplierId VARCHAR2 PATH &apos;$.SupplierId&apos;,&lt;br/&gt;             PurchaseOrderId VARCHAR2 PATH &apos;$.PurchaseOrderId&apos;&lt;br/&gt;             )&lt;br/&gt;             )&lt;br/&gt;             );  &lt;br/&gt;  COMMIT;&lt;br/&gt;&lt;br/&gt;    select &apos;successful operation&apos;&lt;br/&gt;    into l_msg&lt;br/&gt;    from dual;&lt;br/&gt;&lt;br/&gt;    p_msg := l_msg;    &lt;br/&gt;&lt;br/&gt;EXCEPTION&lt;br/&gt;  WHEN OTHERS THEN&lt;br/&gt;    select &apos;Invalid input (e.g. if the StoreId, SupplierId, or ProductId could not be found.&apos;&lt;br/&gt;    into l_msg&lt;br/&gt;    from dual;&lt;br/&gt;&lt;br/&gt;    p_msg := l_msg;&lt;br/&gt;&lt;br/&gt;    END;    &lt;br/&gt;&lt;br/&gt;END;</source>
</StoredProcedureOraclev10g>