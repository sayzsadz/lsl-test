<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="XXPBSA_HO_EXECUTE_IMPORT_PRC" directorySegmentName="seg_0" id="2E87641D-D9AA-4041-97B8-0435724484CA">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>XXPBSA_HO_EXECUTE_IMPORT_PRC</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:29 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE procedure APEX.XXPBSA_HO_EXECUTE_IMPORT_PRC (p_proc_name varchar2, p_param1 varchar2, p_param2 varchar2, p_response out varchar2)&lt;br/&gt;as&lt;br/&gt;    l_token_type    varchar2(50);&lt;br/&gt;    l_access_token  varchar2(2000);&lt;br/&gt;    p_token_type    varchar2(50);&lt;br/&gt;    p_access_token  varchar2(2000);&lt;br/&gt;    l_response      clob;&lt;br/&gt;    l_response1     varchar2(100);&lt;br/&gt;    l_url           varchar2(100);&lt;br/&gt;    l_https_host    varchar2(100);&lt;br/&gt;    l_wallet_path   varchar2(50);&lt;br/&gt;    sqlstring       varchar2(10000);&lt;br/&gt;    l_param         varchar2(50);&lt;br/&gt;    l_payload       varchar2(2000);&lt;br/&gt;&lt;br/&gt;    cursor cur&lt;br/&gt;    is&lt;br/&gt;      select HOST,&lt;br/&gt;             PORT,&lt;br/&gt;             BASE_URL,&lt;br/&gt;             ENDPOINT_URL,&lt;br/&gt;             PROTOCOL,&lt;br/&gt;             PROCNAME,&lt;br/&gt;             TO_CHAR(SYSTIMESTAMP - INTERVAL &apos;1&apos; DAY, &apos;yyyy-mm-dd&quot;T&quot;HH24:MI:SS.SSTZH:TZM&apos;) START_DATE,&lt;br/&gt;             TO_CHAR(systimestamp, &apos;yyyy-mm-dd&quot;T&quot;HH24:MI:SS.SSTZH:TZM&apos;) END_DATE&lt;br/&gt;      from XXPBSA_HO_ENDPOINTS&lt;br/&gt;      where PROCNAME in (   &apos;purchase-orders&apos;,&lt;br/&gt;                            &apos;supplier-returns&apos;,&lt;br/&gt;                            &apos;rejected-lines&apos;,&lt;br/&gt;                            &apos;suppliers&apos;&lt;br/&gt;                        )&lt;br/&gt;            --and PROCNAME in (&apos;purchase-orders&apos;, &apos;suppliers&apos;)&lt;br/&gt;            and PROCNAME = p_proc_name;&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;    &lt;br/&gt;    --l_payload := XXPBSA_PO_PAYLOAD(p_po_num =&gt; l_param);&lt;br/&gt;    &lt;br/&gt;    --XXPBSA_HO_REQUEST_PBSA_TOKEN;&lt;br/&gt;&lt;br/&gt;    select TOKEN_TYPE&lt;br/&gt;          ,ACCESS_TOKEN&lt;br/&gt;          ,URL&lt;br/&gt;          ,HTTPS_HOST&lt;br/&gt;          ,WALLET_PATH&lt;br/&gt;    into l_token_type&lt;br/&gt;        ,l_access_token&lt;br/&gt;        ,l_url&lt;br/&gt;        ,l_https_host&lt;br/&gt;        ,l_wallet_path&lt;br/&gt;    from XXPBSA_HO_OAUTH&lt;br/&gt;    where rownum = 1; &lt;br/&gt;&lt;br/&gt;    for cur_rec in cur&lt;br/&gt;    loop&lt;br/&gt;&lt;br/&gt;    if cur_rec.PROCNAME = &apos;purchase-orders&apos;&lt;br/&gt;      then&lt;br/&gt;&lt;br/&gt;            dbms_output.put_line(&apos;purchase-orders procedure 1.&apos;);&lt;br/&gt;&lt;br/&gt;            select xxpbsa_ho_request_pbsapos_data (   p_url        =&gt; cur_rec.PROTOCOL||cur_rec.HOST||cur_rec.PORT||cur_rec.BASE_URL||cur_rec.ENDPOINT_URL&lt;br/&gt;                                                    , p_proc_name  =&gt; p_proc_name&lt;br/&gt;                                                    , p_param1     =&gt; p_param1&lt;br/&gt;                                                    , p_param2     =&gt; p_param2&lt;br/&gt;                                                   )&lt;br/&gt;            into l_response&lt;br/&gt;            from dual;&lt;br/&gt;&lt;br/&gt;            update XXPBSA_HO_ENDPOINTS&lt;br/&gt;            set STATUS = &apos;P&apos;, PARAMETER1 = l_response&lt;br/&gt;            where PROCNAME = cur_rec.PROCNAME;&lt;br/&gt;            &lt;br/&gt;            --commit;&lt;br/&gt;&lt;br/&gt;    elsif cur_rec.PROCNAME = &apos;supplier-returns&apos;&lt;br/&gt;      then &lt;br/&gt;&lt;br/&gt;            dbms_output.put_line(&apos;supplier-returns procedure 2.&apos;);&lt;br/&gt;&lt;br/&gt;            select xxpbsa_ho_request_pbsapos_data (   p_url        =&gt; cur_rec.PROTOCOL||cur_rec.HOST||cur_rec.PORT||cur_rec.BASE_URL||cur_rec.ENDPOINT_URL&lt;br/&gt;                                                    , p_proc_name  =&gt; p_proc_name&lt;br/&gt;                                                    , p_param1     =&gt; p_param1&lt;br/&gt;                                                    , p_param2     =&gt; p_param2                                                    &lt;br/&gt;                                                   )&lt;br/&gt;            into l_response&lt;br/&gt;            from dual;&lt;br/&gt;&lt;br/&gt;            update XXPBSA_HO_ENDPOINTS&lt;br/&gt;            set STATUS = &apos;P&apos;, PARAMETER1 = l_response&lt;br/&gt;            where PROCNAME = cur_rec.PROCNAME;&lt;br/&gt;&lt;br/&gt;    elsif cur_rec.PROCNAME = &apos;rejected-lines&apos;&lt;br/&gt;      then &lt;br/&gt;            dbms_output.put_line(&apos;rejected-lines procedure 3.&apos;); &lt;br/&gt;&lt;br/&gt;            select xxpbsa_ho_request_pbsapos_data (   p_url         =&gt; cur_rec.PROTOCOL||cur_rec.HOST||cur_rec.PORT||cur_rec.BASE_URL||cur_rec.ENDPOINT_URL&lt;br/&gt;                                                    , p_proc_name   =&gt; p_proc_name&lt;br/&gt;                                                    , p_param1      =&gt; p_param1&lt;br/&gt;                                                    , p_param2      =&gt; p_param2&lt;br/&gt;                                                   )&lt;br/&gt;            into l_response&lt;br/&gt;            from dual;&lt;br/&gt;&lt;br/&gt;            update XXPBSA_HO_ENDPOINTS&lt;br/&gt;            set STATUS = &apos;P&apos;, PARAMETER1 = l_response&lt;br/&gt;            where PROCNAME = cur_rec.PROCNAME;      &lt;br/&gt;&lt;br/&gt;    elsif cur_rec.PROCNAME = &apos;suppliers&apos;&lt;br/&gt;      then &lt;br/&gt;&lt;br/&gt;            dbms_output.put_line(&apos;suppliers procedure 4&apos;); &lt;br/&gt;&lt;br/&gt;            select xxpbsa_ho_request_pbsapos_data (   p_url        =&gt; cur_rec.PROTOCOL||cur_rec.HOST||cur_rec.PORT||cur_rec.BASE_URL||cur_rec.ENDPOINT_URL&lt;br/&gt;                                                   ,  p_proc_name  =&gt; p_proc_name &lt;br/&gt;                                                    , p_param1     =&gt; p_param1&lt;br/&gt;                                                    , p_param2     =&gt; p_param2&lt;br/&gt;                                                   )&lt;br/&gt;            into l_response&lt;br/&gt;            from dual;&lt;br/&gt;&lt;br/&gt;            update XXPBSA_HO_ENDPOINTS&lt;br/&gt;            set STATUS = &apos;P&apos;, PARAMETER1 = l_response&lt;br/&gt;            where PROCNAME = cur_rec.PROCNAME;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    else&lt;br/&gt;      dbms_output.put_line(&apos;no procedure&apos;);&lt;br/&gt;    end if;      &lt;br/&gt;&lt;br/&gt;    end loop;&lt;br/&gt;&lt;br/&gt;end;</source>
</StoredProcedureOraclev10g>