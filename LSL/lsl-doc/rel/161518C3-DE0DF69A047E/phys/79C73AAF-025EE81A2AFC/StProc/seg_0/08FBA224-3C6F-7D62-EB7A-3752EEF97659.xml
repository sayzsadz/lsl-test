<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="CREATE_PURCHASE_REQUEST" directorySegmentName="seg_0" id="08FBA224-3C6F-7D62-EB7A-3752EEF97659">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>CREATE_PURCHASE_REQUEST</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:25 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE PROCEDURE APEX.CREATE_PURCHASE_REQUEST (p_data IN varchar2, p_msg OUT varchar2)&lt;br/&gt;AS&lt;br/&gt;l_msg         varchar2(1000);&lt;br/&gt;BEGIN&lt;br/&gt;  BEGIN&lt;br/&gt;   INSERT INTO PURCHASE_REQUESTS_HEADER (PurchaseRequestId, DateRequired, StoreId, Street, City, State, PostCode, Country, ContactName, Phone, Email)&lt;br/&gt;   SELECT PurchaseRequestId, DateRequired, StoreId, Street, City, State, PostCode, Country, ContactName, Phone, Email        &lt;br/&gt;   FROM json_table(p_data format JSON , &apos;$&apos; COLUMNS &lt;br/&gt;   ( PurchaseRequestId VARCHAR2 PATH &apos;$.PurchaseRequestId&apos;,    &lt;br/&gt;     DateRequired VARCHAR2 PATH &apos;$.DateRequired&apos;, &lt;br/&gt;     StoreId VARCHAR2 PATH &apos;$.StoreId&apos;,&lt;br/&gt;     Street VARCHAR2 PATH &apos;$.Address.Street&apos;, &lt;br/&gt;     City VARCHAR2 PATH &apos;$.Address.City&apos;, &lt;br/&gt;     State VARCHAR2 PATH &apos;$.Address.State&apos;, &lt;br/&gt;     PostCode VARCHAR2 PATH &apos;$.Address.PostCode&apos;, &lt;br/&gt;     Country VARCHAR2 PATH &apos;$.Address.Country&apos;, &lt;br/&gt;     ContactName VARCHAR2 PATH &apos;$.Address.ContactName&apos;, &lt;br/&gt;     Phone VARCHAR2 PATH &apos;$.Address.Phone&apos;, &lt;br/&gt;     Email VARCHAR2 PATH &apos;$.Address.Email&apos;));&lt;br/&gt;             &lt;br/&gt;   INSERT INTO PURCHASE_REQUESTS_LINES (PurchaseRequestId, PurchaseRequestLineId, ProductId, Quantity, Unit, SupplierId, PerUnitCost, &lt;br/&gt;          PerUnitCostTax, LineTotalCost, LineTotalCostTax, PerUnitPrice, PerUnitPriceTax, PurchaseOrderId)&lt;br/&gt;   SELECT  PurchaseRequestId, PurchaseRequestLineId, ProductId, Quantity, Unit, SupplierId, PerUnitCost, &lt;br/&gt;          PerUnitCostTax, LineTotalCost, LineTotalCostTax, PerUnitPrice, PerUnitPriceTax, PurchaseOrderId     &lt;br/&gt;         FROM json_table(p_data format JSON , &apos;$&apos; COLUMNS &lt;br/&gt;         ( PurchaseRequestId VARCHAR2 PATH &apos;$.PurchaseRequestId&apos;,    &lt;br/&gt;           DateRequired VARCHAR2 PATH &apos;$.DateRequired&apos;, &lt;br/&gt;           StoreId VARCHAR2 PATH &apos;$.StoreId&apos;, &lt;br/&gt;           Street VARCHAR2 PATH &apos;$.Address.Street&apos;, &lt;br/&gt;           City VARCHAR2 PATH &apos;$.Address.City&apos;, &lt;br/&gt;           State VARCHAR2 PATH &apos;$.Address.State&apos;, &lt;br/&gt;           PostCode VARCHAR2 PATH &apos;$.Address.PostCode&apos;, &lt;br/&gt;           Country VARCHAR2 PATH &apos;$.Address.Country&apos;, &lt;br/&gt;           ContactName VARCHAR2 PATH &apos;$.Address.ContactName&apos;, &lt;br/&gt;           Phone VARCHAR2 PATH &apos;$.Address.Phone&apos;, &lt;br/&gt;           Email VARCHAR2 PATH &apos;$.Address.Email&apos;,  &lt;br/&gt;         NESTED PATH &apos;$.Lines[*]&apos; &lt;br/&gt;         COLUMNS ( PurchaseRequestLineId VARCHAR2 PATH &apos;$.PurchaseRequestLineId&apos;, &lt;br/&gt;                   ProductId VARCHAR2 PATH &apos;$.ProductId&apos;,&lt;br/&gt;                   Quantity VARCHAR2 PATH &apos;$.Quantity&apos;,&lt;br/&gt;                   Unit VARCHAR2 PATH &apos;$.Unit&apos;,&lt;br/&gt;                   SupplierId VARCHAR2 PATH &apos;$.SupplierId&apos;,&lt;br/&gt;                   PerUnitCost VARCHAR2 PATH &apos;$.PerUnitCost&apos;,&lt;br/&gt;                   PerUnitCostTax VARCHAR2 PATH &apos;$.PerUnitCostTax&apos;,&lt;br/&gt;                   LineTotalCost VARCHAR2 PATH &apos;$.LineTotalCost&apos;,&lt;br/&gt;                   LineTotalCostTax VARCHAR2 PATH &apos;$.LineTotalCostTax&apos;,&lt;br/&gt;                   PerUnitPrice VARCHAR2 PATH &apos;$.PerUnitPrice&apos;,&lt;br/&gt;                   PerUnitPriceTax VARCHAR2 PATH &apos;$.PerUnitPriceTax&apos;,&lt;br/&gt;                   PurchaseOrderId VARCHAR2 PATH &apos;$.PurchaseOrderId&apos; )));&lt;br/&gt;  COMMIT;&lt;br/&gt;&lt;br/&gt;    select &apos;successful operation&apos;&lt;br/&gt;    into l_msg&lt;br/&gt;    from dual;&lt;br/&gt;&lt;br/&gt;    p_msg := l_msg;    &lt;br/&gt;    &lt;br/&gt;EXCEPTION&lt;br/&gt;  WHEN OTHERS THEN&lt;br/&gt;    select &apos;Invalid input (e.g. if the StoreId, SupplierId, or ProductId could not be found.&apos;&lt;br/&gt;    into l_msg&lt;br/&gt;    from dual;&lt;br/&gt;    &lt;br/&gt;    p_msg := l_msg;&lt;br/&gt;    &lt;br/&gt;    END;    &lt;br/&gt;END;</source>
</StoredProcedureOraclev10g>