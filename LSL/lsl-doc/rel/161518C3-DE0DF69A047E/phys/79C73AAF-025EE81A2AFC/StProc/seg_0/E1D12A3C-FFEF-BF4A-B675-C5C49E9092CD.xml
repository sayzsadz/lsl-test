<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="XXPBSA_EXECUTE_SUP_IMPORT_PRC" directorySegmentName="seg_0" id="E1D12A3C-FFEF-BF4A-B675-C5C49E9092CD">
<sourceConnName>LSL_Cloud_apex</sourceConnName>
<sourceObjSchema>APEX</sourceObjSchema>
<sourceObjName>XXPBSA_EXECUTE_SUP_IMPORT_PRC</sourceObjName>
<createdBy>sjayasinghe1</createdBy>
<createdTime>2019-04-29 11:48:29 UTC</createdTime>
<ownerDesignName>lsl-doc</ownerDesignName>
<owner>FB5DE12D-4EA4-254B-AA97-4ED35945C6A7</owner>
<source>CREATE OR REPLACE PROCEDURE APEX.XXPBSA_EXECUTE_SUP_IMPORT_PRC&lt;br/&gt;as&lt;br/&gt;    l_token_type    varchar2(50);&lt;br/&gt;    l_access_token  varchar2(2000);&lt;br/&gt;    p_token_type    varchar2(50);&lt;br/&gt;    p_access_token  varchar2(2000);&lt;br/&gt;    l_response      varchar2(20000);&lt;br/&gt;    l_url           varchar2(100);&lt;br/&gt;    l_https_host    varchar2(100);&lt;br/&gt;    l_wallet_path   varchar2(50);&lt;br/&gt;    sqlstring       varchar2(10000);&lt;br/&gt;&lt;br/&gt;    cursor cur&lt;br/&gt;    is&lt;br/&gt;      select HOST,&lt;br/&gt;             PORT,&lt;br/&gt;             BASE_URL,&lt;br/&gt;             ENDPOINT_URL,&lt;br/&gt;             PROTOCOL,&lt;br/&gt;             PROCNAME,&lt;br/&gt;             TO_CHAR(SYSTIMESTAMP - INTERVAL &apos;1&apos; DAY, &apos;yyyy-mm-dd&quot;T&quot;HH24:MI:SS.SSTZH:TZM&apos;) START_DATE,&lt;br/&gt;             TO_CHAR(systimestamp, &apos;yyyy-mm-dd&quot;T&quot;HH24:MI:SS.SSTZH:TZM&apos;) END_DATE,&lt;br/&gt;             &apos;1&apos; OUTLET&lt;br/&gt;      from XXPBSA_ENDPOINTS&lt;br/&gt;      where PROCNAME in (   &lt;br/&gt;                            &apos;create_sup_returns_summary&apos;&lt;br/&gt;                        );&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;    xxpbsa_request_pbsa_token;&lt;br/&gt;&lt;br/&gt;    select TOKEN_TYPE&lt;br/&gt;          ,ACCESS_TOKEN&lt;br/&gt;          ,URL&lt;br/&gt;          ,HTTPS_HOST&lt;br/&gt;          ,WALLET_PATH&lt;br/&gt;    into l_token_type&lt;br/&gt;        ,l_access_token&lt;br/&gt;        ,l_url&lt;br/&gt;        ,l_https_host&lt;br/&gt;        ,l_wallet_path&lt;br/&gt;    from XXPBSA_OAUTH&lt;br/&gt;    where rownum = 1; &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;--    DBMS_OUTPUT.put_line(&apos;Token Type: &apos;||l_token_type);&lt;br/&gt;--    DBMS_OUTPUT.put_line(&apos;Access Token: &apos;||l_access_token);&lt;br/&gt;&lt;br/&gt;    for cur_rec in cur&lt;br/&gt;    loop&lt;br/&gt;    select xxpbsa_request_pbsapos_data (  p_url           =&gt; cur_rec.PROTOCOL||cur_rec.HOST||cur_rec.PORT||cur_rec.BASE_URL||cur_rec.ENDPOINT_URL&lt;br/&gt;                                        , p_date_from     =&gt; cur_rec.START_DATE&lt;br/&gt;                                        , p_date_to       =&gt; cur_rec.END_DATE&lt;br/&gt;                                        , p_store_id      =&gt; cur_rec.OUTLET&lt;br/&gt;                                       )&lt;br/&gt;    into l_response&lt;br/&gt;    from dual;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    --sqlstring := cur_rec.PROCNAME || &apos;(&apos; || l_response || &apos;)&apos;;&lt;br/&gt;&lt;br/&gt;    --dbms_output.put_line(sqlstring);&lt;br/&gt;&lt;br/&gt;    --execute immediate sqlstring;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    if cur_rec.PROCNAME = &apos;create_sup_returns_summary&apos;&lt;br/&gt;      then create_supplier_return_summary(l_response);&lt;br/&gt;      dbms_output.put_line(&apos;create_sup_returns_summary procedure 9.&apos;);&lt;br/&gt;    else&lt;br/&gt;      dbms_output.put_line(&apos;no procedure&apos;);&lt;br/&gt;    end if;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    update XXPBSA_ENDPOINTS&lt;br/&gt;    set STATUS = &apos;P&apos;, PARAMETER1 = l_response&lt;br/&gt;    where PROCNAME = cur_rec.PROCNAME;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    end loop;&lt;br/&gt;    --DBMS_OUTPUT.put_line(&apos;detailed error message: &apos;||UTL_HTTP.get_detailed_sqlerrm);&lt;br/&gt;&lt;br/&gt;end;</source>
</StoredProcedureOraclev10g>